#!/usr/bin/env bash
set -euo pipefail

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
BOLD='\033[1m'
NC='\033[0m' # No Color

# Get the project root directory
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$PROJECT_ROOT"

echo -e "${BLUE}${BOLD}ðŸš€ Building tdh and tool binaries...${NC}"
echo

# Create build directory if it doesn't exist
mkdir -p build

# Build main tdh binary
echo -e "${GREEN}Building tdh...${NC}"
go build -o build/tdh ./cmd/tdh
echo -e "${GREEN}âœ… tdh built${NC}"
echo

# Build completion generator
echo -e "${GREEN}Building tdh-completion...${NC}"
go build -o build/tdh-completion ./cmd/tools/tdh-completion
echo -e "${GREEN}âœ… tdh-completion built${NC}"
echo

# Build man page generator
echo -e "${GREEN}Building tdh-manpage...${NC}"
go build -o build/tdh-manpage ./cmd/tools/tdh-manpage
echo -e "${GREEN}âœ… tdh-manpage built${NC}"
echo

echo -e "${GREEN}${BOLD}âœ… All binaries built successfully!${NC}"
echo -e "${YELLOW}Binaries are in: ${PROJECT_ROOT}/build/${NC}"

# List built binaries
echo
echo -e "${BLUE}Built binaries:${NC}"
ls -la build/ | grep -E '^-' | awk '{print "  " $9}'